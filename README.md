# Smart Home Domophone Emulator

Система эмуляции домофонов с веб-интерфейсом управления и MQTT-брокером для интеграции с системами умного дома.

## Архитектура

Система состоит из четырех основных компонентов:

- **Emulator** - эмулятор домофонов, генерирующий события и обрабатывающий команды
- **Web Server** - веб-интерфейс для управления домофонами и просмотра событий
- **MQTT Broker** - брокер сообщений для обмена данными между компонентами
- **PostgreSQL** - база данных для хранения информации о домофонах и событиях

## Требования

- Docker
- Docker Compose
- Python 3.11+

## Установка и запуск

1. Клонируйте репозиторий:
```bash
git clone https://github.com/bogdnnx/SmartDomophone_Emulator.git
cd SmartDomophone_Emulator
```

2. Создайте файл конфигурации:
```bash
cp .env.example .env
```

3. Отредактируйте `.env` файл, изменив пароли и настройки по необходимости.

4. Запустите систему:
```bash
docker compose up --build
```

## Конфигурация

Основные параметры настраиваются в файле `.env`:

- `POSTGRES_USER` - пользователь базы данных
- `POSTGRES_PASSWORD` - пароль базы данных
- `POSTGRES_DB` - название базы данных
- `MQTT_BROKER` - адрес MQTT-брокера
- `WEB_PORT` - порт веб-интерфейса
- `DB_PORT` - порт базы данных

## Использование

После запуска система будет доступна по адресу `http://localhost:8000`.

### Веб-интерфейс

Веб-интерфейс предоставляет следующие возможности:

- Просмотр списка домофонов и их статусов
- Управление ключами доступа (добавление/удаление)
- Отправка команд домофонам (открытие/закрытие двери, звонок)
- Просмотр событий и логов
- Управление активностью домофонов

### MQTT-топики

Система использует следующие MQTT-топики:

- `domophone/commands` - команды для домофонов
- `domophone/status` - статусы домофонов
- `domophone/events` - события домофонов

### Команды домофонов

Поддерживаемые команды:

- `open_door` - открыть дверь
- `close_door` - закрыть дверь
- `call_to_flat` - позвонить в квартиру
- `add_keys` - добавить ключи
- `remove_keys` - удалить ключи
- `make_active` - активировать домофон
- `make_unactive` - деактивировать домофон


### Зависимости

Проект использует Poetry для управления зависимостями:

- FastAPI - веб-фреймворк
- SQLModel - ORM для работы с базой данных
- Paho-MQTT - MQTT клиент
- Alembic - миграции базы данных
- Uvicorn - ASGI сервер


## Мониторинг и логирование

Система ведет логирование всех операций:

- Логи эмулятора содержат информацию о событиях домофонов
- Логи веб-сервера содержат информацию о HTTP-запросах
- Логи базы данных содержат информацию о миграциях

Для просмотра логов используйте:
```bash
docker compose logs [service_name]
```
